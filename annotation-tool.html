---
layout: default
title: Medical Annotation Tool
---

<h1>Medical Annotation Tool</h1>

<!-- Step 1: API Key Input -->
<div id="apiPrompt">
    <div id="apiForm">
        <h2>Please enter your OpenAI API key to proceed:</h2>
        <input type="text" id="apikey" placeholder="Enter API key">
        <button id="apikeyBtn">Submit</button>
    </div>
</div>

<!-- Problems and Annotations (hidden initially) -->
<div id="annotation-tool" style="display:none;">
    <div id="problems-container"></div>
    <button onclick="handleSaveAll()">Save All Annotations</button>
</div>

<script>
// Variables to store problems and annotations
let problems = [];
let annotations = [];
let apiKey = "";

// Handle API key submission (this is based on your provided code)
document.getElementById('apikeyBtn').addEventListener('click', function() {
    apiKey = document.getElementById('apikey').value;
    if (apiKey) {
        document.getElementById('apiPrompt').style.display = 'none';
        document.getElementById('annotation-tool').style.display = 'block';
        loadProblems();
    } else {
        alert('Please enter a valid API key.');
    }
});

// Load JSONL file and display problems
async function loadProblems() {
    const response = await fetch('test.jsonl'); // Assumes the JSONL file is hosted or accessible via a relative path
    const text = await response.text();
    problems = text.trim().split('\n').map((line, index) => ({ ...JSON.parse(line), index }));
    displayProblems();
}

// Display all problems on the page
function displayProblems() {
    const problemsContainer = document.getElementById('problems-container');
    problemsContainer.innerHTML = ''; // Clear previous content
    
    problems.forEach(problem => {
        const problemDiv = document.createElement('div');
        problemDiv.classList.add('problem-block');
        problemDiv.innerHTML = `
            <h2>Problem ${problem.index + 1}</h2>
            <p>${problem.question}</p>
            <h3>Options</h3>
            <ul>
              ${Object.keys(problem.options).map(key => `<li>${key}: ${problem.options[key]}</li>`).join('')}
            </ul>
            <h3>LLM Reasoning</h3>
            <div id="llm-reasoning-${problem.index}" class="llm-reasoning" contenteditable="true">Loading reasoning...</div>
        `;
        problemsContainer.appendChild(problemDiv);
        
        // Generate LLM Reasoning for each problem
        generateLLMReasoning(problem, apiKey, problem.index);
    });
}

// Function to generate LLM reasoning (this integrates with the GPT-4o-mini model)
async function generateLLMReasoning(problem, apiKey, index) {
    const apiUrl = "https://api.openai.com/v1/completions";
    const headers = {
        "Content-Type": "application/json",
        "Authorization": `Bearer ${apiKey}`
    };

    const body = JSON.stringify({
        model: "gpt-4o-mini",
        prompt: `Question: ${problem.question}\nOptions: ${Object.values(problem.options).join(', ')}\nAnswer: ${problem.answer}\nExplain the reasoning.`,
        max_tokens: 150
    });

    try {
        const response = await fetch(apiUrl, {
            method: 'POST',
            headers: headers,
            body: body
        });
    
        const data = await response.json();
        document.getElementById(`llm-reasoning-${index}`).textContent = data.choices[0].text.trim();
    } catch (error) {
        document.getElementById(`llm-reasoning-${index}`).textContent = "Error generating reasoning.";
    }
}
</script>

<style>
  .problem-block {
    border-bottom: 1px solid #ccc;
    margin-bottom: 20px;
  }
</style>
